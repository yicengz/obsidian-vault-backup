主要负责内容车端一级主题智舱（智能座舱）主题，这部分的数据是车端的核心内容，主要包括车辆传感器上报的数据，用户与车机交互的数据，以及上传到车联网上的数据，这三个主要的数据来源由于数据量巨大都是通过车或云端走kafka采集到大数据平台的。其中传感器上报的数据例如车内温度，空调是否打开，哪几个座位的状态是占位型的数据等，数据是以kv的格式上传的，通常我们跟整车的同时约定上报频率是秒级，日增量大概在10e左右。用户与车机交互的数据我们一般叫做cdc的日志，他包涵了用户通过中控触摸得到的得到的埋点日志，语音对车下达指令的语音日志，地图搜索类的导航日志等等等等，这类数据通常是通过人来触发的，因此数据量级较其他的来源会稍微少点，大概在1kw左右，但是日志中记录的信息是作为用户行为分析的一个重要因素。车辆上报到云端的数据我们一般叫soa日志，soa是我们业务部门维护的服务平台，所有的功能都需要挂载到这个平台上用户才能更新和使用，这部分主要是记录云端接收到的一系列请求和响应日志，也是数据量最大的，后期销量破万后基本每天都是以百亿的数据去增长的。针对以上三个来源的数据我通过对各方的调研给出了一些建设的方案，首先采集此部分数据到贴源层的操作都是通过log2hive的方案以小时级为频率从文件系统抽取到hive中，在dwd加工明细数据时，除了进行基本相同的数据清洗策略，像数据去重（要求比较严苛，保证每ms只有一条对应的日志)，跨天，跨月的数据上报清洗等，针对数据的不同复杂程度制定了不同的建模方案，由简到繁的顺序为cdc埋点->ee信号->soa信号。cdc埋点中在dwd层我通过业务部门发布的文档中通过在线表格的抽取获取其页面和元素粒度下的维度信息，然后附加上了人和车的基础维度的信息配置好对应的dqc就完成，方便在dwd基础数据之后的数据获取和使用。针对ee信号主要数据实际上就是一个车辆当前时间戳下的信号名，信号值，并且数据量巨大符合高窄表的特征，因此针对这部分数据我做的更多的是保证数据可支撑的范围尽量不变的情况下去完成数据量的缩减问题，我通过对实际场景的调研发现传感器信号虽然是每秒上报的但是大部分的传感器都是在一个周期内维持着同一个状态，例如空调，档位类的信息基本在某次使用过程中都是不变，并且在此类数据使用时基本不会涉及到以时间戳为关联条件的关联，因此我决定在dwd层中改变存储的粒度将车+时间+信号粒度合并为车+时间段的粒度，并保留了该周期内上报时间戳的数据集合，并将此类模型的维护策略和使用说明上传至数据手册中，通过此类操作即可以明确标记车辆真实传感数据，又将每日数据从10e缩减至2e左右。针对soa信号则更为复杂，soa所记录的日志信息则更全，可以理解为cdc和ee是车辆自身产生通过我们采集过来的。soa则是云端以各接口为粒度在车辆操作后云端会响应，甚至还包含服务队第三方接口调用的记录，既记录了客户端的请求信息也记录了云端的响应信息，数据量更为巨大且复杂。也是经过一系列复杂的调研我发现对于每个接口来说都有一个event or method的属性，这是定义了一个接口实际功能，因此当时我当时以此为依据制定的方案是对这两类接口尽心分治，其中event类型的接口就是周期类上报的接口，这类接口与前面介绍的ee信号非常接近，可以采用按照对应的建模方式去建设，而method的类型实际上是触发型的接口，就是在调用后才会留存对应的日志，实际也会与cdc这种埋点触发类的日志结构相似，因此也算是得益于之前的场景去进行建模，并通过soa中的接口文档做了自动化的接口信息解析，拿到每个接口的各个属性，像安全等级，对应中文释义等并加载之模型中，在拓展基本维度后，将每日百e的数据量缩减至10e+，同样对此类数据的说明和使用也均配置至数据使用手册中。